{
  "variables": {
    "gcpcreds_location": null,
    "gcpcreds_filename": null,
    "datasource_user": null,
    "datasource_password": null
  },

  "builders": [
    {
      "type": "googlecompute",
      "source_image_family": "ubuntu-1604-lts",
      "ssh_username": "godlyd",
      "project_id": "godlydpatruljen",
      "zone": "europe-west3-a"
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "script": "packer_files/write_to_bashrc.sh",
      "environment_vars": [
        "GCPCREDS_FILENAME={{user `gcpcreds_filename`}}",
        "DATASOURCE_USER={{user `datasource_user`}}",
        "DATASOURCE_PASSWORD={{user `datasource_password`}}"
      ]
    },
    {
      "type": "file",
      "source": "packer_files/nginx.conf",
      "destination": "/tmp/nginx.conf"
    },
    {
      "type": "file",
      "source": "../api/docker-compose.yml",
      "destination": "/tmp/docker-compose.yml"
    },
    {
      "type": "file",
      "source": "{{user `gcpcreds_location`}}/{{user `gcpcreds_filename`}}",
      "destination": "/tmp/{{user `gcpcreds_filename`}}"
    },
    {
      "type": "shell",
      "scripts": [
        "packer_files/install_packages.sh",
        "packer_files/configure_packages.sh"
      ],
      "environment_vars": [
        "GCPCREDS_FILENAME={{user `gcpcreds_filename`}}"
      ]
    }
  ]
}
